<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>光敏電阻即時數值顯示</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="static/js/bower_components/webduino-js/dist/webduino-all.js"></script>
  <script src="static/js/webduino-blockly.js"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: sans-serif;
      background: #1e1e1e;
      color: #fff;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 20px;
      text-align: center;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
    }

    #lightValue {
      font-size: 2em;
      font-weight: bold;
      margin-top: 20px;
      color: #00e676;
    }

    .bulb {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background-color: #333;
      box-shadow: 0 0 20px rgba(255, 255, 100, 0);
      transition: all 0.2s ease-in-out;
    }

    @media (min-width: 768px) {
      .bulb {
        width: 200px;
        height: 200px;
      }
    }

    @media (max-width: 600px) {
      .bulb {
        width: 100px;
        height: 100px;
      }

      #lightValue {
        font-size: 1.5em;
      }
    }
  </style>
</head>
<body>

  <header>
    <h2>Webduino 光敏電阻數值顯示</h2>
  </header>

  <main>
    <div class="bulb" id="bulb"></div>
    <div id="lightValue">讀取中...</div>
  </main>

  <script>
    var photocell, matrix;
    const valueDisplay = document.getElementById("lightValue");
    const bulb = document.getElementById("bulb");

    function updateBulbBrightness(val) {
      const brightness = Math.max(0, Math.min(1, val));
      const intensity = Math.floor(255 * brightness);
      const glow = brightness * 120;

      bulb.style.backgroundColor = `rgb(${intensity}, ${intensity}, 100)`;
      bulb.style.boxShadow = `0 0 ${glow}px ${glow / 2}px rgba(255, 255, 120, ${brightness})`;
    }

    boardReady({board: 'Smart', device: '10QbmGAV', transport: 'mqtt'}, function (board) {
      board.systemReset();
      board.samplingInterval = 100;

      matrix = getMax7219(board, 14, 12, 13);
      matrix.animateStop();

      photocell = getPhotocell(board, 0);
      photocell.on(function(val) {
        valueDisplay.textContent = val.toFixed(2);
        updateBulbBrightness(val);

        if (val >= 0.9 && val < 1.0) {
          matrix.on("ffffffffffffffff");
        } else if (val >= 0.8 && val < 0.9) {
          matrix.on("3c7effffffff7e3c");
        } else if (val >= 0.7 && val < 0.8) {
          matrix.on("187e7effff7e7e18");
        } else if (val >= 0.6 && val < 0.7) {
          matrix.on("083c7efe7f7e3c10");
        } else if (val >= 0.5 && val < 0.6) {
          matrix.on("001c7c7e7e3e3800");
        } else if (val >= 0.4 && val < 0.5) {
          matrix.on("00047c3c3c3e2000");
        } else if (val >= 0.3 && val < 0.4) {
          matrix.on("00003c3c3c3c0000");
        } else if (val >= 0.2 && val < 0.3) {
          matrix.on("0000183c3c180000");
        } else if (val >= 0.1 && val < 0.2) {
          matrix.on("0000001818000000");
        } else if (val >= 0.0 && val < 0.1) {
          matrix.on("0000000000000000");
        }
      });
    });
  </script>

</body>
</html>
